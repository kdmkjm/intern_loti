<?xml version="1.0" encoding="euc-kr" ?>

<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="Cmn_PopupUser">

	<typeAlias alias="Cmn_PopupUser" type="loti.cmn.common.model.Cmn_PopupUser"/>

	<!-- ¸ñ·ÏÁ¶È¸Äõ¸® -->
	<select id="selectCmn_PopupUserList" parameterClass="Cmn_PopupUser" resultClass="Cmn_PopupUser">
		SELECT  
            B.JUMINNO, B.USERNAME, B.CELLPHONE,
            CASE 
                WHEN (SELECT (SELECT SIMPLENAME FROM CMN_ORGANMAP WHERE ORGANCODE = C.PARENTORGAN) FROM CMN_ORGANMAP C WHERE C.ORGANCODE = A.PARENTORGAN) = 'org'
                 AND (SELECT (SELECT SIMPLENAME FROM CMN_ORGANMAP WHERE ORGANCODE = C.PARENTORGAN) FROM CMN_ORGANMAP C WHERE C.ORGANCODE = A.PARENTORGAN) != (SELECT (SELECT SIMPLENAME FROM CMN_ORGANMAP WHERE ORGANCODE = C.CHIEFORGAN) FROM CMN_ORGANMAP C WHERE C.ORGANCODE = A.CHIEFORGAN)
                 AND (SELECT SIMPLENAME FROM CMN_ORGANMAP WHERE ORGANCODE = A.PARENTORGAN) != (SELECT SIMPLENAME FROM CMN_ORGANMAP WHERE ORGANCODE = A.CHIEFORGAN)
                THEN            
                    DECODE((SELECT (SELECT SIMPLENAME FROM CMN_ORGANMAP WHERE ORGANCODE = C.CHIEFORGAN) FROM CMN_ORGANMAP C WHERE C.ORGANCODE = A.CHIEFORGAN), 
                    'org', (SELECT SIMPLENAME FROM CMN_ORGANMAP WHERE ORGANCODE = A.CHIEFORGAN), 
                    (SELECT (SELECT SIMPLENAME FROM CMN_ORGANMAP WHERE ORGANCODE = C.CHIEFORGAN) FROM CMN_ORGANMAP C WHERE C.ORGANCODE = A.CHIEFORGAN))
                    ||DECODE((SELECT SIMPLENAME FROM CMN_ORGANMAP WHERE ORGANCODE = A.CHIEFORGAN), NULL, '´ë±¸±¤¿ª½Ã', 'org', REPLACE(SIMPLENAME, 'org', ''), ' '||REPLACE(SIMPLENAME, 'org', ''))
                ELSE            
                    DECODE((SELECT (SELECT SIMPLENAME FROM CMN_ORGANMAP WHERE ORGANCODE = C.PARENTORGAN) FROM CMN_ORGANMAP C WHERE C.ORGANCODE = A.PARENTORGAN), 
                    'org', (SELECT SIMPLENAME FROM CMN_ORGANMAP WHERE ORGANCODE = A.PARENTORGAN), 
                    (SELECT (SELECT SIMPLENAME FROM CMN_ORGANMAP WHERE ORGANCODE = C.PARENTORGAN) FROM CMN_ORGANMAP C WHERE C.ORGANCODE = A.PARENTORGAN))
                    ||DECODE((SELECT SIMPLENAME FROM CMN_ORGANMAP WHERE ORGANCODE = A.PARENTORGAN), NULL, '´ë±¸±¤¿ª½Ã', 'org', REPLACE(SIMPLENAME, 'org', ''), ' '||REPLACE(SIMPLENAME, 'org', ''))       
            END SIMPLENAME
      FROM  CMN_PUBWORKER B, CMN_ORGANMAP A
     WHERE  A.ORGANCODE = B.ORGANCODE
		<isNotEmpty property="searchKeywordUserName">
       AND (B.USERNAME   LIKE '%' ||  #searchKeywordUserName# || '%'
        OR  ORGANNAME LIKE '%' ||  #searchKeywordUserName# || '%')
		</isNotEmpty>
	ORDER BY	B.USERNAME
	</select>

</sqlMap>


